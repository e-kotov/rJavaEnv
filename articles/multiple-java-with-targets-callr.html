<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Multiple Java environments in one project with targets and callr • rJavaEnv</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="multiple-java-with-targets-callr_files/libs/quarto-html/popper.min.js"></script><script src="multiple-java-with-targets-callr_files/libs/quarto-html/tippy.umd.min.js"></script><link href="multiple-java-with-targets-callr_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="multiple-java-with-targets-callr_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Multiple Java environments in one project with targets and callr">
<meta property="og:image" content="https://www.ekotov.pro/rJavaEnv/reference/figures/card.png">
<meta property="og:image:alt" content="rJavaEnv: Java Environments for R Projects. Install and manage Java environments using R">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@EgorKotov">
<meta name="twitter:site" content="@EgorKotov">
<!-- counter.dev analytics --><script data-goatcounter="https://jukadipos.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script><!-- counter.dev analytics --><script src="https://cdn.counter.dev/script.js" data-id="7e3e8d31-9a84-48b0-a678-a00715236a90" data-utcoffset="1"></script><script>
 (function(h,o,t,j,a,r){
     h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
     h._hjSettings={hjid:3578286,hjsv:6};
     a=o.getElementsByTagName('head')[0];
     r=o.createElement('script');r.async=1;
     r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
     a.appendChild(r);
 })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rJavaEnv</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/rJavaEnv.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/rJavaEnv-step-by-step.html">Step-by-step: Download, Install, and Setup `Java` for 'R' Projects</a></li>
    <li><a class="dropdown-item" href="../articles/multiple-java-with-targets-callr.html">Multiple `Java` environments in one project with `targets` and `callr`</a></li>
    <li><a class="dropdown-item" href="../articles/why-rJavaEnv.html">Why rJavaEnv: the landscape of 'Java'-dependent R packages</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/e-kotov/rJavaEnv/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Multiple <code>Java</code> environments in one project with <code>targets</code> and <code>callr</code>
</h1>




      <small class="dont-index">Source: <a href="https://github.com/e-kotov/rJavaEnv/blob/main/vignettes/multiple-java-with-targets-callr.qmd" class="external-link"><code>vignettes/multiple-java-with-targets-callr.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <p>If you need to use multiple <code>Java</code> distribution versions in a single project, you can use a handy shortcut function <code><a href="../reference/use_java.html">use_java()</a></code> kindly <a href="https://github.com/e-kotov/rJavaEnv/issues/44" target="_blank" class="external-link">suggested by Hadley Wickham</a>.</p>
<p>Essentialy, <code><a href="../reference/use_java.html">use_java()</a></code> does the same thing as <code><a href="../reference/java_quick_install.html">java_quick_install()</a></code>, but in a less intrusive way. It downloads the distribution of the user requested major version of <code>Java</code>, unpacks it, also to the cache folder, but unlike <code><a href="../reference/java_quick_install.html">java_quick_install()</a></code>, it does not copy or link the <code>Java</code> installation folder from cache into the project directory and does not create or edit your <code>.Rprofile</code> file. Instead, it just sets the environment in the current R script to the requested <code>Java</code> binaries in the cache folder. The download and unpacking only happens once, so each next run is practically instant, as the function only needs to set the environment in the current R script.</p>
<section class="section level2"><h2 id="how-to-use-use_java">How to use <code>use_java()</code>
<a class="anchor" aria-label="anchor" href="#how-to-use-use_java"></a>
</h2>
<p>Let’s illustrate this with a simple example.</p>
<p>First, load the package and check the valid major versions of <code>Java</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/e-kotov/rJavaEnv" class="external-link">rJavaEnv</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/java_valid_versions.html">java_valid_versions</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<pre><code>[1] "8"  "11" "15" "16" "17" "18" "19" "20" "21" "22" "23" "24"</code></pre>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p>The available versions of <code>Java</code> depend on your OS and architecture, so you might see a shorter list on your system.</p>
</blockquote>
</div>
<p>Now select any two or three versions and run <code><a href="../reference/use_java.html">use_java()</a></code>, checking every time that correct java was set in the current environment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/use_java.html">use_java</a></span><span class="op">(</span><span class="st">"8"</span><span class="op">)</span></span>
<span><span class="st">"8"</span> <span class="op">==</span> <span class="fu"><a href="../reference/java_check_version_cmd.html">java_check_version_cmd</a></span><span class="op">(</span>quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="st">"8"</span> <span class="op">==</span> <span class="fu"><a href="../reference/java_check_version_rjava.html">java_check_version_rjava</a></span><span class="op">(</span>quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<pre><code>[1] TRUE
[1] TRUE</code></pre>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/use_java.html">use_java</a></span><span class="op">(</span><span class="fl">17</span><span class="op">)</span></span>
<span><span class="st">"17"</span> <span class="op">==</span> <span class="fu"><a href="../reference/java_check_version_cmd.html">java_check_version_cmd</a></span><span class="op">(</span>quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="st">"17"</span> <span class="op">==</span> <span class="fu"><a href="../reference/java_check_version_rjava.html">java_check_version_rjava</a></span><span class="op">(</span>quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<pre><code>[1] TRUE
[1] TRUE</code></pre>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/use_java.html">use_java</a></span><span class="op">(</span><span class="fl">21</span><span class="op">)</span></span>
<span><span class="st">"21"</span> <span class="op">==</span> <span class="fu"><a href="../reference/java_check_version_cmd.html">java_check_version_cmd</a></span><span class="op">(</span>quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="st">"21"</span> <span class="op">==</span> <span class="fu"><a href="../reference/java_check_version_rjava.html">java_check_version_rjava</a></span><span class="op">(</span>quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<pre><code>[1] TRUE
[1] TRUE</code></pre>
<p>You probably had to wait for a bit for the Java distribution to be downloaded and unpacked.</p>
<p>However, now if you repeat the same commands, you will see that the correct <code>Java</code> version is set instantly, as downloading and unpacking are skipped.</p>
</section><section class="section level2"><h2 id="how-to-use-with-targets-and-callr">How to use with <code>targets</code> and <code>callr</code>
<a class="anchor" aria-label="anchor" href="#how-to-use-with-targets-and-callr"></a>
</h2>
<p>Both <a href="https://docs.ropensci.org/targets/" target="_blank" class="external-link"><code>{targets}</code></a> and <a href="https://callr.r-lib.org/" target="_blank" class="external-link"><code>{callr}</code></a> packages allow the user to run any R scripts in clean separate R sessions. This essentially allows the user to run multiple versions of <code>Java</code> in one project with <code>targets</code> and <code>callr</code>, mostly overcoming the issue of manually switching between <code>Java</code> versions in one project.</p>
<p>One simple thing you can do if one of the scripts needs Java 8, and another one needs Java 17, is to insert <code><a href="../reference/use_java.html">use_java()</a></code> in beginning of the scripts that you run through <code>targets</code> or <code>callr</code> like so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/e-kotov/rJavaEnv" class="external-link">rJavaEnv</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/use_java.html">use_java</a></span><span class="op">(</span><span class="st">"17"</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Or:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rJavaEnv</span><span class="fu">::</span><span class="fu"><a href="../reference/use_java.html">use_java</a></span><span class="op">(</span><span class="st">"17"</span><span class="op">)</span></span></code></pre></div>
</div>
<p>The first run of such script will have to go through the the process of downloading and unpacking the <code>Java</code> distribution. The second run will not need to download and unpacking and will be instant.</p>
<p>If you need the runs to be instant from the first attempt, you can predownload and pre-install <code>Java</code> into cache folders using:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">java_17_distrib</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/java_download.html">java_download</a></span><span class="op">(</span><span class="st">"17"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/java_unpack.html">java_unpack</a></span><span class="op">(</span><span class="va">java_17_distrib</span><span class="op">)</span></span></code></pre></div>
</div>
</section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.ekotov.pro" class="external-link">Egor Kotov</a>, Chung-hong Chan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
